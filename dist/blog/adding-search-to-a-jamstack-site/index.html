<!doctype html><html lang="en" class="dark-theme theme-steelblue"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="preload" href="/fonts/placardmtstd-cond-webfont.woff2" as="font" type="font/woff2" crossorigin><style>code{font-family:Menlo, Monaco, "Courier New", monospace;font-size:0.8em}code[class*="language-"],pre[class*="language-"]{-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;white-space:pre;white-space:pre-wrap;word-wrap:normal;font-family:Menlo, Monaco, "Courier New", monospace;line-height:1.8;color:#76d9e6;text-shadow:none}pre[class*="language-"],:not(pre)>code[class*="language-"]{background:#2a2a2a}pre[class*="language-"]{padding:2em;margin:0.5em -2em;border-radius:4px;overflow:auto}pre[class*="language-"]{position:relative}pre[class*="language-"] code{white-space:pre;display:block}:not(pre)>code[class*="language-"]{padding:0.15em 0.2em 0.05em;border-radius:.3em;border:0.13em solid #7a6652;box-shadow:1px 1px 0.3em -0.1em #000 inset}.token.namespace{opacity:.7}.token.comment,.token.prolog,.token.doctype,.token.cdata{color:#6f705e}.token.operator,.token.boolean,.token.number{color:#a77afe}.token.attr-name,.token.string{color:#e6d06c}.token.entity,.token.url,.language-css .token.string,.style .token.string{color:#e6d06c}.token.selector,.token.inserted{color:#a6e22d}.token.atrule,.token.attr-value,.token.keyword,.token.important,.token.deleted{color:#ef3b7d}.token.regex,.token.statement{color:#76d9e6}.token.placeholder,.token.variable{color:#fff}.token.important,.token.statement,.token.bold{font-weight:bold}.token.punctuation{color:#bebec5}.token.entity{cursor:help}.token.italic{font-style:italic}code.language-markup{color:#f9f9f9}code.language-markup .token.tag{color:#ef3b7d}code.language-markup .token.attr-name{color:#a6e22d}code.language-markup .token.attr-value{color:#e6d06c}code.language-markup .token.style,code.language-markup .token.script{color:#76d9e6}code.language-markup .token.script .token.keyword{color:#76d9e6}mark.highlight-line{color:inherit;background-color:rgba(255,255,255,0.08);display:inline-block}.theme-ruby{--theme-base: 158, 48, 40}.theme-black{--theme-base:34, 34, 34}.theme-red{--theme-base:175, 42, 64}.theme-blue{--theme-base:59, 88, 162}.theme-brightblue{--theme-base:36, 107, 189}.theme-darkblue{--theme-base:62, 78, 117}.theme-greyblue{--theme-base:50, 61, 62}.theme-lime{--theme-base:123, 137, 45}.theme-seagreen{--theme-base:87, 134, 113}.theme-sepia{--theme-base:86, 80, 67}.theme-steelblue{--theme-base: 91, 117, 137}.theme-teal{--theme-base: 48, 165, 156}.theme-khaki{--theme-base: 179, 175, 112}.theme-neonblue{--theme-base: 30, 235, 250}.theme-neongreen{--theme-base: 173, 247, 0}.theme-nearwhite{--theme-base: 245, 245, 245}.dark-theme{background-color:rgba(var(--theme-base), 0.3)}.dark-theme .sidebar{color:rgba(255,255,255,0.7);background-color:rgba(var(--theme-base), 1)}.dark-theme a.home{color:rgba(var(--theme-base), 1)}.dark-theme blockquote{border-left-color:rgba(var(--theme-base), 0.1)}.dark-theme .solid-footer{background-color:rgba(var(--theme-base), 1);color:rgba(255,255,255,0.6)}.dark-theme form{background-color:rgba(var(--theme-base), 0.1)}.bright-theme{background-color:rgba(var(--theme-base), 0.3)}.bright-theme .sidebar{color:rgba(0,0,0,0.7);background-color:rgba(var(--theme-base), 1)}.bright-theme .sidebar h1{color:rgba(0,0,0,0.8)}.bright-theme .sidebar a{color:#000;border-color:rgba(0,0,0,0.6)}.bright-theme .sidebar a.home{color:rgba(var(--theme-base), 1);background-color:rgba(0,0,0,0.8)}.bright-theme .sidebar ul.nav a:hover{background-color:rgba(0,0,0,0.06)}.bright-theme .sidebar ul.nav a.home:hover{background-color:rgba(0,0,0,0.9)}.bright-theme blockquote{border-left-color:rgba(var(--theme-base), 0.3)}.bright-theme .search-ui,.bright-theme .teaser{background-color:rgba(0,0,0,0.03)}.bright-theme .search-ui a,.bright-theme .teaser a{color:#000}.bright-theme .solid-footer{background-color:rgba(var(--theme-base), 1);color:rgba(0,0,0,0.6)}.bright-theme .solid-footer a{color:#000}@font-face{font-family:Placard;src:url("/fonts/placardmtstd-cond-webfont.woff2") format("woff2"),url("/fonts/placardmtstd-cond-webfont.woff") format("woff");font-display:swap}html,body{margin:0;padding:0}body{text-align:center;color:#444;font-family:Georgia, serif;font-weight:normal;line-height:28px;font-size:14px}@media (min-width: 500px){body{line-height:31px;font-size:16px}}@media (min-width: 1266px){body{display:flex;flex-direction:row}}@media (min-width: 1266px){.sidebar{width:45%;min-height:100vh}}.sidebar header{position:sticky;top:0}.main{background-color:#fff}@media (min-width: 1266px){.main{width:55%}}.container,.sidebar-container{width:80%;text-align:left;margin-left:auto;margin-right:auto}@media (min-width: 800px){.container,.sidebar-container{width:70%;max-width:700px}}@media (min-width: 1266px){.container,.sidebar-container{width:60%;max-width:600px}}.container{padding-top:3em;padding-bottom:4em}@media (min-width: 1266px){.container{margin-left:4em}}@media (min-width: 1266px){.sidebar-container{margin-right:3em}}.page-details{margin-top:5em;padding-bottom:5em}@media (min-width: 500px){.page-details{max-width:80%}}@media (min-width: 800px){.page-details{max-width:450px}}@media (min-width: 1266px){.page-details{max-width:100%}}a{text-decoration:none;border-bottom-style:solid;border-bottom-width:1px}ul,ol{padding-left:1em}ul.tags{list-style:none;margin-top:0.5em;margin-left:0;padding-left:0;font-size:0.9em}ul.tags li{line-height:1.5}a.tag:link,a.tag:visited{border-bottom-style:none}h1,h2,h3,h4{font-family:arial, sans-serif;padding-top:1em;line-height:1.2}h1{font-family:Placard, arial, sans-serif;font-size:3.8em;line-height:1;text-transform:uppercase;font-weight:normal;margin-top:0;margin-bottom:0;padding-top:0.3rem;padding-bottom:0.4rem}h2{font-size:1.6em}h3{font-size:1.2em}h4{font-size:1.1em}.no-wrap{white-space:nowrap}.avatar-large{width:120px;border-radius:4px;border:solid 2px #fff;box-shadow:#000 0 0 4px}.main img{width:100%;padding-top:1em;padding-bottom:1em}.by-line{font-size:0.8em}.excerpt{font-style:italic;font-size:1.1em}blockquote{margin-left:0;padding:0.01em 1.5em;border-left-style:solid;border-left-width:0.8em}.phonetic{font-size:1.5rem;margin-top:0}hr{border-style:none;border-bottom:solid 1px #eee;margin:2em 0}form{border-radius:2px;padding:1em 2em;margin:2em -2em 1em -2em}label small{opacity:0.6em;display:block}input,textarea{width:100%;border:solid 1px #bbb;padding:0.2em;font-size:1.2rem}textarea{height:8rem}.btn,button{cursor:pointer;font-size:1em;background-color:#555;color:#fff;font-family:Georgia, serif;border-style:none;padding:0.5em 1em;border-radius:3px}.honey{display:none}.needs-content{border-color:#af2a40}.blog-list-item{padding:1em 0 2em}.blog-list-item h2,.blog-list-item h3{margin-top:0;margin-bottom:0;padding-top:0;padding-bottom:0}.blog-list-item .by-line{margin-bottom:0}.blog-list-item .grab{margin-top:1em;margin-bottom:0}.blog-list-item img{margin:0;padding:0}img.flag{width:1em}a.more-link{background-color:#eee;display:inline-block}img.external-link{width:0.8em;padding-left:0.4em;vertical-align:middle;opacity:0.3}h2 img.external-link{width:0.6em}.tweet{font-size:0.9em;background-color:rgba(0,0,0,0.03);border-radius:4px;padding:2em 2em 1em;margin:1em -2em 0.5em}header ul.nav{font-family:Arial, sans-serif;font-weight:bold;font-size:0.9em;list-style:none;margin:0;padding:0}header ul.nav li{display:inline}header ul.nav a{display:inline-block;padding:4em 0.5em 0.2em 0.5em;border-bottom-style:none}header ul.nav a.home{padding-left:0.7em;padding-right:0.7em}header ul.nav a.blog{padding-left:1em}.search-ui,.teaser{font-size:1.4em;margin:0 0 2em 0;padding:0.5em 1em;border-radius:3px;background-color:rgba(255,255,255,0.05)}.search-ui span,.teaser span{display:block}.search-ui a,.teaser a{color:#fff}.invisible{display:none}.search-ui{margin:1em -1em;padding-top:1em}.search-results{font-size:0.8em}pre{overflow:auto}footer .solid-footer{font-size:0.7em;line-height:1.5;padding:3em 0}@media (min-width: 1266px){footer{position:fixed;width:45%;bottom:0;left:0}}footer .container{padding:0}@media (min-width: 1266px){footer .container{margin-right:3rem;margin-left:auto}}.thumbnail-grid{display:flex;flex-flow:row wrap;align-items:flex-start;justify-content:space-between}.thumbnail-grid a:link,.thumbnail-grid a:visited{border-bottom-style:none;width:22%}.thumbnail-grid a:link:hover img,.thumbnail-grid a:link:focus img,.thumbnail-grid a:visited:hover img,.thumbnail-grid a:visited:focus img{filter:grayscale(0%)}.thumbnail-grid img{border:solid 4px #fff;padding:0;margin:0;filter:grayscale(90%);transition-duration:0.5s}.embed-container{position:relative;width:100%;padding-bottom:56.25%;height:0;margin-top:2em}.embed-container iframe{position:absolute;top:0;left:0;width:100%;height:100%}html{background-color:#d6d6d6}a{border-bottom-color:#9bf}a:link,a:visited{color:#46c}a:hover,a:focus{color:#2755de;border-bottom-color:#2755de}blockquote{border-left-color:#ebebeb}.solid-footer{color:#adadad;background-color:#333}@media (min-width: 1266px){.solid-footer{background-color:rgba(0,0,0,0.05)}}.solid-footer a{color:#fff;border-style:none}.blog-list-item h2 a,.blog-list-item h3 a{color:#444}form{background-color:#f9f9f9}.sidebar{background-color:#333;color:#d6d6d6}.sidebar h1{color:#fff}.sidebar a{color:#fff;border-color:#fff}.sidebar a.home{color:#333;background-color:#fff}.sidebar ul.nav a:hover{background-color:rgba(255,255,255,0.06)}.sidebar ul.nav a.home:hover{background-color:#fff}a.floating-lozenge{border-style:none}a.floating-lozenge img{border-radius:5px;box-shadow:0 1px 5px 0px rgba(0,0,0,0.37);padding-top:0;padding-bottom:0}a.floating-lozenge:hover img,a.floating-lozenge:focus img{box-shadow:0 1px 10px 0px rgba(0,0,0,0.45)}</style><title>Adding search to a JAMstack site</title><meta name="description" content="Using progressive enhancement, JavaScript and a static site generator to create site search facility."><link rel="alternate" href="/feed.xml" title="Hawksworx blog feed, by Phil Hawksworth" type="application/atom+xml"><link rel="apple-touch-icon" sizes="57x57" href="/images/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/images/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/images/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/images/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/images/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/images/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/images/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/images/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/images/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/images/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicons/favicon-16x16.png"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/images/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@philhawksworth"><meta name="twitter:creator" content="@philhawksworth"><meta property="og:url" content="https://www.hawksworx.com/"><meta property="og:title" content="Phil Hawksworth"><meta property="og:description" content="Using progressive enhancement, JavaScript and a static site generator to create site search facility."><meta property="og:image" content="https://www.hawksworx.com/card-image/-blog-adding-search-to-a-jamstack-site-card.png"></head><body><div class="sidebar"><header><div class="sidebar-container"><ul class="nav"><li><a href="/" class="home">pvxrecords.com</a></li><li><a href="/releases" class="blog">releases</a></li><li><a href="/bands">bands</a></li><li><a href="/history">history</a></li><li><a href="/contact">contact</a></li></ul><div class="search-ui invisible"><input type="text" id="search-str" class="search-str"><ol class="search-results"><ol></ol></ol></div><div class="page-details"><p class="by-line">October 17th 2018 by <a href="/about">Phil Hawksworth</a></p><h1>Adding search to a JAMstack&nbsp;site</h1><ul class="tags"><li><a href="/tags/jamstack" class="tag">#jamstack</a></li><li><a href="/tags/javascript" class="tag">#javascript</a></li><li><a href="/tags/tips" class="tag">#tips</a></li></ul></div></div></header></div><div class="main"><div class="container"><div class="excerpt"><p>Search is often cited as a limitation of static sites. Searching <em>feels</em> dynamic, so surely it is impossible on a <em>static</em> site, right? Thankfully not. Here is a nice technique to use with most any <a href="https://staticgen.com">static site generator</a> and a little JavaScript as a progressive enhancement to add search functionality to your <a href="https://jamstack.org">JAMstack</a> site.</p><p><img src="/images/sandro-kradolfer-1077230-unsplash.jpg" alt="Searching" &nbsp;title="Searching"></p></div><p>There are a number of services available to can bring fully featured, rich, search functionality to your sites. If I had needed more sophisticated searching, with things like fuzzy matching, related content associations, and deep search analytics, I could have used a service like <a href="https://www.algolia.com/">Algolia</a>, who are experts in this sort of thing.</p><h2>Some requirements</h2><p>My needs on this site are relatively simple. So rather than using an external service I wanted to roll my own simple search which would help people find content in my blog posts. I set myself the following requirements:</p><blockquote><ol><li>Using JavaScript for the best experience is fine, but searching should be possible without it.</li><li>Searching should feel very fast, and find items in my blog by looking at the blog post titles and content.</li><li>No additional overhead of JavaScript libraries or third party services, so I could keep things simple and manageable.</li><li>No impact on the perceived page speed whatsoever.</li></ol></blockquote><h2>The technique</h2><p>A summary of the approach I chose to take is:</p><ol><li>Provide a Google search form as a fallback on a Search page</li><li>Hijack the link to that Search page with JavaScript</li><li>When a user clicks search, silently load a <a href="/search.json">JSON index</a> of the content</li><li>Display a search UI</li><li>On each keypress in the search UI, search our JSON for string matches</li><li>Display links to the matches found</li></ol><p>Let's look at some of this a little more closely.</p><h3>Setting a baseline</h3><p>The first step was to set a good baseline from which to progressively enhance with JavaScript. Creating a js-free fallback is much more difficult than setting a working baseline before JavaScript ever enters the picture. I'd recommend this approach no matter what you are building.</p><p>I added <em>Search</em> to the primary navigation of the site. You can see it up at the top of the page. This is a regular old link to a page on the site which I'll hijack with JavaScript later. For now, it goes to <a href="/search">the search page</a>.</p><p>On the search page, I'll lean on an external search engine to provide the ability to search the site. Most leading search engines allow for this. Here's I'm using Google. An HTML form with some parameters will send a search request to Google, scoped for this site.</p><p>The HTML looks like this:</p><pre class="language-html"><code class="language-html"><span class="highlight-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://www.google.co.uk/search<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>get<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span><br><span class="highlight-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>q<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>q<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>site:http://hawksworx.com<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span><br><span class="highlight-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>search-str<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Search <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>small</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span></span><br><span class="highlight-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>q<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>search-str<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></span><br><span class="highlight-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Search with Google<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span></span><br><span class="highlight-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></span></code></pre><p>That gives us a form which will perform a Google search on this site (you can do this directly in google by scoping your search query with <code>site:http://hawksworx.com/</code>). The results are displayed on Google, and the links point back to the correct pages here on the site.</p><p>We have our baseline.</p><h3>Hijacking the search link</h3><p>The search link can stay just the same. No need to add any inline JavaScript. Things can stay unobtrusive so that if JavaScript is unavailable the link is just a link.</p><pre class="language-html"><code class="language-html"><span class="highlight-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/search<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>search-link<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>search<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></span></code></pre><p>Now with JavaScript, we add an event handler to trigger our search feature if somebody clicks on search. We also suppress the standard link behavior since we're not navigating away from the current page.</p><pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token comment">// attach a click handler to the search link</span></span><br><span class="highlight-line"><span class="token keyword">var</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#search-link'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">  <span class="token comment">// don't navigate to that page. Stay put.</span></span><br><span class="highlight-line">  event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">  <span class="token comment">// make search magic happen instead...</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><h3>Loading an index object to inspect</h3><p>Until the user indicated that they intend to search by clicking the Search link, we dont need to load in our search index. That helps to keep the page weight down. Once they have clicked the link it's time to go and get our data. While we show the UI and the user contemplates what they intend to search for, while silently fetch the data with JavaScript.</p><pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token comment">// get the data</span></span><br><span class="highlight-line"><span class="token keyword">const</span> searchIndex<span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/search.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  searchIndex <span class="token operator">=</span> response<span class="token punctuation">.</span>search<span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>This <a href="/search.json"><code>searchIndex</code></a> is now available to our JavaScript for some string matching. We'll search our index for whatever the user enters into the search UI which we displayed while fetching the data. The search we perform against our index is very basic, but more than adequate for what we need here.</p><pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token comment">// look for matches in each item in the JSON</span></span><br><span class="highlight-line"><span class="token keyword">var</span> results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> item <span class="token keyword">in</span> searchIndex <span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token keyword">var</span> found <span class="token operator">=</span> searchIndex<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>searchString<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">  <span class="token keyword">if</span><span class="token punctuation">(</span>found <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    results<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>searchIndex<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">)</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">// now display the items in our results array...</span></span></code></pre><h3>Generating our search index</h3><p>So far so good. We can load some JSON when required, and perform some rudimentary string matching against it. but where does this search index come from? That's where a static site generator can really help us.</p><blockquote><p>A static site generate creates the output we need by applying templates to structured data</p></blockquote><p>Since this site is built using a static site generator, it is already interpreting the its content as structured data and outputting that data in whatever shape I need. All I need to do is create a suitable template which will output the content of my blog not as html, but as a JSON object.</p><p>generating this search index can be done at build time, so it is ready to serve up as a static resource when my JavaScript needs it. A nice performance and resilience bonus.</p><p>Currently, I am using a static site generator called <a href="https://11ty.io">Eleventy</a> to generate this site. With Eleventy, making a template to output my search.json is straight forward.</p><pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token operator">--</span><span class="token operator">-</span></span><br><span class="highlight-line">permalink<span class="token punctuation">:</span> search<span class="token punctuation">.</span>json</span><br><span class="highlight-line"><span class="token operator">--</span><span class="token operator">-</span></span><br><span class="highlight-line"><span class="token punctuation">{</span><span class="token string">"search"</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span></span><br><span class="highlight-line"><span class="token punctuation">{</span><span class="token operator">%</span><span class="token operator">-</span> <span class="token keyword">for</span> item <span class="token keyword">in</span> collections<span class="token punctuation">.</span>posts <span class="token operator">-</span><span class="token operator">%</span><span class="token punctuation">}</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token string">"url"</span> <span class="token punctuation">:</span> <span class="token string">"{{ item.url }}"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token string">"title"</span> <span class="token punctuation">:</span> <span class="token string">"{{ item.data.title }}"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token string">"text"</span> <span class="token punctuation">:</span> <span class="token string">"{{ (item.data.title + "</span> <span class="token string">" + item.templateContent) | squash }}"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">if</span> not loop<span class="token punctuation">.</span>last <span class="token operator">%</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">else</span> <span class="token operator">%</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token operator">%</span><span class="token operator">-</span> endif <span class="token operator">-</span><span class="token operator">%</span><span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token punctuation">{</span><span class="token operator">%</span><span class="token operator">-</span> endfor <span class="token operator">-</span><span class="token operator">%</span><span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token punctuation">]</span><span class="token punctuation">}</span></span></code></pre><p>By iterating over the collection of posts for the site, I can construct the JSON to suit my needs later. For convenience I chose:</p><ul><li>A url: To link the user to the correct page</li><li>A title: The page title to display to the user inn the results</li><li>A text index: Which contains every unique word contained in that post's title and text</li></ul><p>To make things a little more efficient, I condensed that text property a little. By passing the content to a filter that I created called <em>sqaush</em> I can massage it into shape a little more. The <a href="https://github.com/philhawksworth/hawksworx.com/blob/8c96ba2541c8fd6fe6f521cdb5e17848c231636c/src/site/_filters/squash.js">squash filter</a> does the following:</p><ul><li>Makes every word lowercase</li><li>Removes all duplicated words.</li><li>Removes words that are less meaningfully for searching. Like <em>on, in, me, my</em> and so on.</li></ul><p>Many static site generators will give you the ability to add filters and utilities in this way. I like <a href="https://www.11ty.io/docs/filters/">how filters work in Eleventy</a> since everything is JavaScript. I don't need to learn Ruby (as I did when I implemented the same thing with less confidence in an earlier version of this site built with Jekyll)</p><h2>The building blocks we need</h2><p>When we bring these building blocks together, we can assemble whatever behaviors we like in our UI. This is a simple search capability, but give it a try. It works nicely.</p><p>When we have the ability to inspect and manipulate the data and content that makes up our sites. And generate data services to expose whatever we like, we gain the ability to craft a wide variety of experiences in our website. Delivering search functionalities like this prove to be far more simple than we might have originally expected.</p><p>With a little imagination, adding this and other dynamic features to JAMstack sites is really satisfying.</p><hr><h4>Photo credits</h4><blockquote><p><em>Sandro Kradolfer - <a href="https://unsplash.com/photos/IVYZWptFt1g" target="NEW" rel="noopener">https://unsplash.com/photos/IVYZWptFt1g</a></em></p></blockquote></div><footer><div class="solid-footer"><div class="container"><div class="teaser"><span>Previously posted:</span> <a href="https://www.netlify.com/blog/2018/10/16/contentful-and-github-help-make-jamstack_conf-a-reality/">Contentful and GitHub help make JAMstack_Conf a reality</a></div><p>The source code of this site is available on <a href="https://www.github.com/philhawksworth/hawksworx.com" target="new" rel="noopener">GitHub</a> and is hosted and updated by <a href="https://www.netlify.com" target="new" rel="noopener">Netlify</a> automatically after each <a href="https://www.github.com/philhawksworth/hawksworx.com/commit/master" target="new" rel="noopener">code commit</a></p><p>Other than where specified, the content on this site is published under a <a href="http://creativecommons.org/licenses/by/3.0/" target="new" rel="noopener">Creative Commons Attribution 3.0 licence</a>.</p><p><a href="/feed.xml">Subscribe to a feed</a> of blog posts on this site.</p></div></div></footer></div><script>function btnHandler(e,t){var n=document.querySelector(e);n&&n.addEventListener("click",function(e){e.preventDefault(),t()},!1)}function flagIfEmpty(e){e.value.length<1&&e.classList.add("needs-content")}btnHandler("#btn-opt-in",function(){var e=new Date,t=e.getTime()+31536e6;e.setTime(t),document.cookie="nf_ab=oh-so-orange; expires="+e.toUTCString(),window.location.reload(!0)}),btnHandler("#btn-opt-out",function(){document.cookie="nf_ab=;expires=Thu, 01 Jan 1970 00:00:01 GMT;",window.location.reload(!0)}),function(){var e=document.querySelectorAll("form");if(0!=e.length)for(var t=0;t<e.length;t++)e[t].addEventListener("submit",function(e){e.preventDefault();for(var t=e.target,n=t.querySelectorAll(".needs-content"),r=0;r<n.length;r++)n[r].classList.remove("needs-content");for(var o=t.querySelectorAll("input"),l=0;l<o.length;l++)flagIfEmpty(o[l]);for(var i=t.querySelectorAll("textarea"),c=0;c<i.length;c++)flagIfEmpty(i[c]);if(1<(n=t.querySelectorAll(".needs-content")).length)return!1;t.submit()},!1)}(),function(){var l=null,e=document.querySelector(".search-ui"),i=document.querySelector(".search-results"),n=document.querySelector("#search-str"),c=document.querySelector("footer"),a=function(){for(;i.firstChild;)i.removeChild(i.firstChild);c.classList.remove("invisible")};btnHandler("#search-link",function(){fetch("/search.json").then(function(e){return e.json()}).then(function(e){l=e.search}),e.classList.toggle("invisible"),n.focus(),n.addEventListener("keyup",function(e){var t=n.value;2<t.length?function(e){e=e.toLowerCase();var t=[];for(var n in l)-1!=l[n].text.indexOf(e)&&t.push(l[n]);for(var n in a(),c.classList.add("invisible"),t){var r=document.createElement("li"),o=document.createElement("a");o.textContent=t[n].title,o.setAttribute("href",t[n].url),r.appendChild(o),i.appendChild(r)}}(t):a()})})}();</script></body></html>